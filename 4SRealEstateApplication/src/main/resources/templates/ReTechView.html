<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
	<head>
		<meta charset="UTF-8">
	    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	    <title>ReTech View</title>
	    
	    <!-- CSS Librerias -->
	    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css">
	    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.1/css/bootstrap-select.css" />
	    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css">
	    <!--  Styles personalizados -->
	    <link rel="stylesheet" href="/css/styles.css">
	</head>
	<body>
		<div class="container mt-5">
		    <h2 class="mb-4">Datos desde el WebService</h2>
		    
		    <form class="needs-validation" novalidate>
		    	<label>Estado:</label>
				<select class="selectpicker" name="estados" multiple data-live-search="true">
					<option value="" disabled selected>Seleccione..</option>
    				<option th:each="estado : ${estadosList}" th:value="${estado.catalogName}" th:text="${estado.catalogName}"></option>
				</select>
				&emsp;
				<label>Tipo:</label> 
				<select class="selectpicker" name="tipos" multiple data-live-search="true">
					<option value="" disabled selected>Seleccione..</option>
    				<option th:each="tipo : ${tipoList}" th:value="${tipo.catalogName}" th:text="${tipo.catalogName}"></option>
				</select>
				&emsp;
				<label>Zona:</label> 
				<select class="selectpicker" name="zonas" multiple data-live-search="true">
					<option value="" disabled selected>Seleccione..</option>
    				<option th:each="zona : ${zonaList}" th:value="${zona.catalogName}" th:text="${zona.catalogName}"></option>
				</select>
				&emsp;
				<label>Segmento:</label> 
				<select class="selectpicker" name="segmentos" multiple data-live-search="true">
					<option value="" disabled selected>Seleccione..</option>
    				<option th:each="segmento : ${segmentoList}" th:value="${segmento.catalogName}" th:text="${segmento.catalogName}"></option>
				</select>
				</br>
				<label>Precio Ficha:</label> 
				<input type="text" id="iniPrecioFBusc" name="iniPrecioFBusc" size="10" /> <label> a </label>
				<input type="text" id="finPrecioFBusc" name="finPrecioFBusc" size="10" />
				&emsp;
				<label>Precio m2:</label> 
				<input type="text" id="iniPrecioM2Busc" name="iniPrecioM2Busc" size="10" /> <label> a </label>
				<input type="text" id="finPrecioM2Busc" name="finPrecioM2Busc" size="10" />
				</br>
				<label>Fecha Scrap:</label>
				<input type="month" id="iniFecBusc" name="iniFecBusc" min="2020-10" /> <label> al </label>
				<input type="month" id="finFecBusc" name="finFecBusc" min="2020-10" />
				</br>
				<button type="submit" id="submit" class="btn btn-primary btn-sm mt-3">Buscar</button>
				</br>
				<button id="exportExcel" class="btn btn-secondary mt-3">Exportar a Excel</button>
				<button id="openPopup" class="btn btn-secondary mt-3">Procesar dormitorios</button>
				
			</form>
			</br>
		    <table id="myTable" class="table table-bordered" style="width:100%">
		        <thead class="table-dark">
		            <tr>
		            	<th>Estado</th>
		                <th>Tipo</th>
		                <th>Zona</th>
		                <th>Segmento</th>
		                <th>Descripción</th> 
		                <th>Recámaras</th>
		                <th>Baños</th>
		                <th>Cajones</th>
		                <th>Ficha precio</th>
		                <th>Superficie cubierta (m2)</th>
		                <th>Precio m2</th>
		                <th>Fecha scrap</th>
		                <th>Latitud</th>
		                <th>Longitud</th>
		            </tr>
		        </thead>
		        <tbody>
		            <tr th:each="data : ${dataList}">
		            	<td th:text="${data.locEstado}"></td>
		                <td th:text="${data.locTipo}"></td>
		                <td th:text="${data.zona}"></td>
		                <td th:text="${data.segmento}"></td>
		                <td style="text-align: center;">
			                <button th:onclick="showDescription([[${data.descripcion}]]);">Detalle</button>
			            </td>
		                <td th:text="${data.dormitorios}"></td>
		                <td th:text="${data.banos}"></td>
		                <td th:text="${data.garages}"></td>
		                <td th:text="'$' + ${#numbers.formatDecimal(data.fichaPrecio, 0, 'COMMA', 2, 'POINT')}"></td>
		                <td th:text="${data.superficieCubierta}"></td>
		                <td th:text="'$' + ${#numbers.formatDecimal(data.precioM2, 0, 'COMMA', 2, 'POINT')}"></td>
		                <td th:text="${data.fechaScrap}" style="text-align: center;"></td>
		                <td th:text="${data.lat}"></td>
		                <td th:text="${data.lng}"></td>
		            </tr>
		        </tbody>
		    </table>
		    <ul class="pagination pagination-lg pager" id="myPager"></ul>
		</div>
		<div id="popupModal" class="modal" tabindex="-1" role="dialog">
			<div class="modal-dialog modal-lg" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title">Descripción</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body">
					  <!-- Aquí se aplica formateo solo para visualización -->
					 	<pre id="popupDescription" style="white-space: pre-wrap; word-wrap: break-word; font-family: inherit;"></pre>
					</div>
					<div class="modal-footer">
					  	<button type="button" class="btn btn-secondary" onclick="closeDescription()" data-bs-dismiss="modal">Cerrar</button>
					</div>
				</div>
			</div>
		</div>
		<!-- Modal procesar dormitorios -->
		<div id="dormitoriosModal" class="modal" tabindex="-1" role="dialog">
		    <div class="modal-dialog" role="document">
		        <div class="modal-content">
		            <div class="modal-header">
		                <h5 class="modal-title">Procesar dormitorios</h5>
		                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
		            </div>
		            <div class="modal-body">
		                <form id="configForm">
		                    <div class="mb-3">
		                        <label for="param1" class="form-label">Precio inicio:</label>
		                        <input type="text" id="precioIniExcel" class="form-control" placeholder="Ingrese el Precio inicio" required>
		                    </div>
		                    <div class="mb-3">
		                        <label for="param2" class="form-label">Precio fin:</label>
		                        <input type="text" id="precioFinExcel" class="form-control" placeholder="Ingrese el Precio fin" required>
		                    </div>
		                    <div class="mb-3">
		                        <label for="param3" class="form-label">Dividido cada:</label>
		                        <input type="text" id="divisorExcel" class="form-control" placeholder="Ingrese el divisor" required>
		                    </div>
		                    <div class="mb-3">
		                    	<input type="radio" id="precioFicha" name="precioXExcel" value="1" />
						        <label for="contactChoice1">Precio Ficha</label>
						        <input type="radio" id="precioM2" name="precioXExcel" value="0" />
						        <label for="contactChoice2">Precio m2</label>
		                    </div>
		                </form>
		            </div>
		            <div class="modal-footer">
		                <button type="button" id="startExport" class="btn btn-primary">Iniciar Exportación</button>
		                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
		            </div>
		        </div>
		    </div>
		</div>
		
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.bundle.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.1/js/bootstrap-select.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/dayjs@1/plugin/customParseFormat.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/dayjs@1/locale/es.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
		<script src="/js/ReTechJS.js"></script>
	</body>
</html>